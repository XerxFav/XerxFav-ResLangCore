name: Phase Test & Coverage

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run tests with coverage
      run: |
        export PYTHONPATH=$(pwd)
        pytest --cov=arca_core --cov-report=term --cov-report=html tests/
        cp -r htmlcov/ coverage_html/

    - name: Phase validation
      run: python arca_fieldcore/generator.py

    - name: Generate ontology
      run: python arca_fieldcore/generate_ontology.py

    - name: Upload coverage report
      uses: actions/upload-artifact@v3
      with:
        name: coverage-html
        path: coverage_html/

    - name: Upload ontology
      uses: actions/upload-artifact@v3
      with:
        name: ontology
        path: ontology.md
#–ï—Å–ª–∏ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å @pytest.mark.phase, –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ñ–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã:
#üìå –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∏–∑–±–∏—Ä–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ñ–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.
    - name: Run phase-marked tests
      run: |
        pytest -m phase --cov=arca_core --cov-report=term --cov-report=html tests/
#üîπ 2. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å Sphinx)

    - name: Build Sphinx docs
      run: |
        cd docs
        make html
#–ò –∑–∞–≥—Ä—É–∑–∫—É –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞:
    - name: Upload documentation
      uses: actions/upload-artifact@v3
      with:
        name: sphinx-docs
        path: docs/build/html/
#üîπ 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ontology.md :–¥–æ–±–∞–≤–∏—Ç—å —Ñ–∞–∑–æ–≤—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é:
    - name: Validate ontology structure
      run: |
        grep "##" ontology.md || echo "Ontology structure missing"



